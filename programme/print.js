// Choose the number of pages of the document
//var nb_page = 32;
var nb_page = $(".preview-page").length;


// Loads main content into <section id="container">
$("#page-1 .cahier .para").load('bdd/load.php?page=page-1&txt=courant');
$("#page-2 .cahier .courant").load('bdd/load.php?page=page-2&txt=courant');
$("#page-3 .cahier .para").load('bdd/load.php?page=page-3&txt=courant');
$("#page-4 .cahier .courant").load('bdd/load.php?page=page-4&txt=courant');
$("#intro-1 .para").load('bdd/load.php?page=intro-1&txt=courant');
$("#intro-2 .para").load('bdd/load.php?page=intro-2&txt=courant');

$("#page-5 .cahier .para").load('bdd/load.php?page=page-5&txt=courant');
$("#page-6 .cahier .courant").load('bdd/load.php?page=page-6&txt=courant');
$("#page-7 .cahier .courant").load('bdd/load.php?page=page-7&txt=courant');
$("#page-8 .cahier .courant").load('bdd/load.php?page=page-8&txt=courant');
$("#page-9 .para").load('bdd/load.php?page=page-9&txt=courant');
$("#page-10 .para").load('bdd/load.php?page=page-10&txt=courant');
$("#page-11 .cahier .courant").load('bdd/load.php?page=page-11&txt=courant');
$("#page-12 .cahier .courant").load('bdd/load.php?page=page-12&txt=courant');
$("#page-13 .para").load('bdd/load.php?page=page-13&txt=courant');
$("#page-14 .para").load('bdd/load.php?page=page-14&txt=courant');
$("#page-15 .cahier .courant").load('bdd/load.php?page=page-15&txt=courant');
$("#page-16 .cahier .courant").load('bdd/load.php?page=page-16&txt=courant');
$("#page-17 .para").load('bdd/load.php?page=page-17&txt=courant');
$("#page-18 .para").load('bdd/load.php?page=page-18&txt=courant');
$("#page-19 .para").load('bdd/load.php?page=page-19&txt=courant');

$("#page-20 .cahier .courant").load('bdd/load.php?page=page-20&txt=courant');
$("#page-21 .cahier .para").load('bdd/load.php?page=page-21&txt=courant');
$("#page-22 .cahier .courant").load('bdd/load.php?page=page-22&txt=courant');
$("#page-23 .cahier .courant").load('bdd/load.php?page=page-23&txt=courant');
$("#page-24 .cahier .courant").load('bdd/load.php?page=page-24&txt=courant');
$("#page-25 .cahier .courant").load('bdd/load.php?page=page-25&txt=courant');
$("#page-26 .cahier .courant").load('bdd/load.php?page=page-26&txt=courant');
$("#page-27 .cahier .courant").load('bdd/load.php?page=page-27&txt=courant');
$("#page-28 .cahier .courant").load('bdd/load.php?page=page-28&txt=courant');
$("#page-29 .cahier .courant").load('bdd/load.php?page=page-29&txt=courant');

$("#page-30 .para").load('bdd/load.php?page=page-30&txt=courant');
$("#page-31 .cahier .para").load('bdd/load.php?page=page-31&txt=courant');
$("#page-32 .cahier .courant").load('bdd/load.php?page=page-32&txt=courant');
$("#page-33 .cahier .courant").load('bdd/load.php?page=page-33&txt=courant');
$("#page-34 .cahier .courant").load('bdd/load.php?page=page-34&txt=courant');
$("#page-35 .cahier .courant").load('bdd/load.php?page=page-35&txt=courant');
$("#page-36 .cahier .courant").load('bdd/load.php?page=page-36&txt=courant');
$("#page-37 .cahier .courant").load('bdd/load.php?page=page-37&txt=courant');
$("#page-38 .cahier .courant").load('bdd/load.php?page=page-38&txt=courant');
$("#page-39 .para").load('bdd/load.php?page=page-39&txt=courant');

$("#page-40 .para").load('bdd/load.php?page=page-40&txt=courant');
$("#page-41 .cahier .courant").load('bdd/load.php?page=page-41&txt=courant');
$("#page-42 .cahier .courant").load('bdd/load.php?page=page-42&txt=courant');
$("#page-43 .para").load('bdd/load.php?page=page-43&txt=courant');
$("#page-44 .para").load('bdd/load.php?page=page-44&txt=courant');
$("#page-45 .para ").load('bdd/load.php?page=page-45&txt=courant');
$("#page-46 .cahier .courant").load('bdd/load.php?page=page-46&txt=courant');
$("#page-47 .cahier .para").load('bdd/load.php?page=page-47&txt=courant');
$("#page-48 .cahier .courant").load('bdd/load.php?page=page-48&txt=courant');
$("#page-49 .cahier .courant").load('bdd/load.php?page=page-49&txt=courant');

$("#page-50 .cahier .courant").load('bdd/load.php?page=page-50&txt=courant');
$("#page-51 .cahier .courant").load('bdd/load.php?page=page-51&txt=courant');
$("#page-52 .cahier .courant").load('bdd/load.php?page=page-52&txt=courant');
$("#page-53 .para").load('bdd/load.php?page=page-53&txt=courant');
$("#page-54 .para").load('bdd/load.php?page=page-54&txt=courant');
$("#page-55 .cahier .courant").load('bdd/load.php?page=page-55&txt=courant');

$("#page-56 .cahier .courant").load('bdd/load.php?page=page-56&txt=courant');
$("#page-57 .cahier .courant").load('bdd/load.php?page=page-57&txt=courant');
$("#page-58 .cahier .courant").load('bdd/load.php?page=page-58&txt=courant');
$("#page-59 .cahier .courant").load('bdd/load.php?page=page-59&txt=courant');
$("#page-60 .cahier .courant").load('bdd/load.php?page=page-60&txt=courant');
$("#page-61 .cahier .para").load('bdd/load.php?page=page-61&txt=courant');
$("#page-62 .cahier .para").load('bdd/load.php?page=page-62&txt=courant');
$("#page-63 .cahier .para").load('bdd/load.php?page=page-63&txt=courant');
$("#page-64 .cahier .para").load('bdd/load.php?page=page-64&txt=courant');
$("#page-65 .cahier .para").load('bdd/load.php?page=page-65&txt=courant');
$("#page-66 .cahier .para").load('bdd/load.php?page=page-66&txt=courant');
$("#page-67 .cahier .para").load('bdd/load.php?page=page-67&txt=courant');
$("#page-68 .cahier .para").load('bdd/load.php?page=page-68&txt=courant');
$("#page-69 .cahier .para").load('bdd/load.php?page=page-69&txt=courant');

$("#page-70 .cahier .courant").load('bdd/load.php?page=page-70&txt=courant');
$("#page-71 .cahier .para").load('bdd/load.php?page=page-71&txt=courant');
$("#page-72 .cahier .para").load('bdd/load.php?page=page-72&txt=courant');
$("#page-73 .cahier .para").load('bdd/load.php?page=page-73&txt=courant');
$("#page-74 .cahier .para").load('bdd/load.php?page=page-74&txt=courant');
$("#page-75 .cahier .para").load('bdd/load.php?page=page-75&txt=courant');
$("#page-76 .cahier .para").load('bdd/load.php?page=page-76&txt=courant');77


$(window).load(function(){
    // __________________________________ DEBUG __________________________________ //
    $("button#7ebug").click(function(e){
        e.preventDefault();
        $(this).toggleClass("button-active");
        $("html").toggleClass("debug");
    });

    // __________________________________ SPREAD __________________________________ //
    $("button#spread").click(function(e){
        e.preventDefault();
        $(this).toggleClass("button-active");
        $("html").toggleClass("spread");
    });

    // __________________________________ MARKER   __________________________________ //
    $("button#marker").click(function(e){
        e.preventDefault();
        $(this).toggleClass("button-active");
        $("html").toggleClass("marker");
    });

    // __________________________________ HIGH RESOLUTION __________________________________ //
    $("button#hi-res").click(function(e){
        e.preventDefault();
        $(this).toggleClass("button-active");
        $("html").toggleClass("export");
        $("img").each(function(){
            var hires = $(this).attr("data-alt-src");
            var lores = $(this).attr("src");
            $(this).attr("data-alt-src", lores);
            $(this).attr("src", hires);
        });
        console.log("Wait for hi-res images to load");
        window.setTimeout(function(){
            console.log("Check image resolution");
            // Redlights images too small for printing
            $("img").each(function(){
                if (Math.ceil(this.naturalHeight / $(this).height()) < 6) {
                    console.log($(this).attr("src") + ": " + Math.floor(this.naturalHeight / $(this).height()) );
                    if($(this).parent().hasClass("moveable")) {
                        $(this).parent().toggleClass("lo-res");
                    } else {
                        $(this).toggleClass("lo-res");
                    }
                }
            });
        }, 2000);
    });


    // __________________________________ PRINT MARKS __________________________________ //
    var doc_height = $("body").height();
    var page_height = $("#master-page").height();

    $(".preview-page").each(function(){
        $(this).append("<div class='inside'>");
        $("#master-page").children().clone().appendTo($(".inside", $(this)));
        $(".cahier", $(this)).appendTo($(".page", $(this)));
        $(".courant", $(this)).appendTo($(".cahier", $(this)));
    });
    $("#master-page").hide();


    // __________________________________ TOC __________________________________ //
    $(".preview-page").each(function(){
        page = $(this).attr("id");
        $("#toc-pages").append("<li><a href='?page=" + page + "#" + page + "'>" + page.replace("-", " ") + "</a></li>")
    });
    $("#goto").click(function(e){
        e.preventDefault();
        $(this).toggleClass("button-active");
        $("#toc-pages").toggle();
    });
    // __________________________________ MODI-CONT __________________________________ //
    //$(".edit-box").hide();
    $("#modi-txt").click(function(e){

        $(this).toggleClass("button-active");
        $(".edit-box").toggle();
        //$(".edit-box").hide();
    });

    // __________________________________ MODI-CONT __________________________________ //


    $(function() {
    $( "#accordion" ).accordion();
    });

    //$("#txt_box").hide();
    //$("#txt_boutton").click(function(e){

        //$(this).toggleClass("button-active");
    //$("#txt_boutton #txt_box").toggle();
        //$(".edit-box").hide();
    //});

    // __________________________________ MOVEABLE ELEMENTS __________________________________ //
    $("div.moveable").
        append("<div class='properties button'>Properties</div>").
        draggable({
                cursor: "move",
                stack: "div.moveable",
                cancel: ".properties",
        }).
        resizable();
    $("button#back2front").click(function(){
        $(this).toggleClass("button-active");
        $(".moveable").toggleClass("foreground");
        $(".preview-page").toggleClass("overflow");
    });

    $('.properties').on('mouseover', function() {
        var top = Math.floor(parseInt($(this).parent().css('top')));
        var left = Math.floor(parseInt($(this).parent().css('left')));
        var width = Math.floor($(this).parent().width());
        var height = Math.floor($(this).parent().height());
        $(this).text('top: ' + top + 'px; left: ' + left + 'px; width: ' + width + 'px; height: ' + height + 'px;')
    });


    // __________________________________ FIGURE COUNTING __________________________________ //
    var figCount = 0;
    var subFigCount = 0;
    var figName = "";
    var alphabet = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"]
    var figures = {}
    $(".preview-page figure").each(function(){
        figName = $(this).attr("class");
        // Si la figure n'existe pas dans le dict
        if (! figures[figName]){
            // on incrémente le compteur
            figCount ++;
            figures[figName] = figCount;
            figures[figName + "-count"] = 0;
            $("figcaption", $(this)).prepend("Fig." + figures[figName] + " ");
        } else {
        // si la figure existe dans le dict
            $("figcaption", $(this)).prepend("Fig." + figures[figName]  + alphabet[figures[figName + '-count']] + " ");
            figures[figName + "-count"] ++;
        }
    });
});
